# Airflow + LogisticRegression


> –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π-—à–∞–±–ª–æ–Ω —Å ETL + ML-–ø–∞–π–ø–ª–∞–π–Ω–æ–º –ø–æ–¥ Airflow.
> –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–Ω —Å–∫–∞—á–∏–≤–∞–µ—Ç –Ω–µ–±–æ–ª—å—à–æ–π CSV-–¥–∞—Ç–∞—Å–µ—Ç, –æ–±—É—á–∞–µ—Ç `LogisticRegression`, —Å—á–∏—Ç–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –≤ GCS –∏ –∫–ª–∞–¥—ë—Ç –ª–æ–∫–∞–ª—å–Ω–æ –≤ `results/`.
>
> –ó–∞–º–µ–Ω–∏—Ç–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –º–æ–¥–µ–ª—å –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî –∏ –ø–æ–ª—É—á–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–¥–∞–∫—à–Ω-–ø–∞–π–ø–ª–∞–π–Ω ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª.
>
> **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤ –ø–∞–ø–∫–µ proofs**

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
‚îú‚îÄ‚îÄ dags/                # DAG Airflow ¬´breast_cancer_pipeline¬ª
‚îú‚îÄ‚îÄ etl/                 # –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–æ–¥—É–ª–∏: load ‚Üí preprocess ‚Üí train ‚Üí evaluate ‚Üí upload
‚îú‚îÄ‚îÄ results/             # –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (csv / pkl / json) —Å–æ–∑–¥–∞—é—Ç—Å—è —Å—é–¥–∞
‚îú‚îÄ‚îÄ logs/                # runtime-–ª–æ–≥–∏ (pipeline_<timestamp>.log)
‚îú‚îÄ‚îÄ proofs/              # —Å–∫—Ä–∏–Ω—à–æ—Ç—ã UI / GCS (–¥–ª—è –æ—Ç—á—ë—Ç–∞)
‚îú‚îÄ‚îÄ keys/                # GCP service-account json (–ù–ï –∫–æ–º–º–∏—Ç–∏–º!)
‚îú‚îÄ‚îÄ docker-compose.yml   # webserver + scheduler
‚îú‚îÄ‚îÄ Dockerfile           # –æ–±—Ä–∞–∑ —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ makefile             # –ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑ Docker/Airflow
‚îú‚îÄ‚îÄ .env                 # –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md            # –≤—ã –∑–¥–µ—Å—å
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

| –ö–ª—é—á                             | –ì–¥–µ –∑–∞–¥–∞—ë—Ç—Å—è                      | –ß—Ç–æ –≤—Å—Ç–∞–≤–∏—Ç—å                                                                                                                                                                     |
| -------------------------------- | --------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `GCP_PROJECT`                    | `.env`                            | ID –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Google Cloud                                                                                                                                                 |
| `GCS_BUCKET`                     | `.env`                            | –∏–º—è –±–∞–∫–µ—Ç–∞                                                                                                                                                                       |
| `GCS_PREFIX`                     | `.env`                            | –ø—Ä–µ—Ñ–∏–∫—Å –≤–Ω—É—Ç—Ä–∏ –±–∞–∫–µ—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `breast_cancer/`)                                                                                                                            |
| `GOOGLE_APPLICATION_CREDENTIALS` | `.env` **–∏** `docker-compose.yml` | –ø—É—Ç—å –∫ `.json`-–∫–ª—é—á—É —Å–µ—Ä–≤–∏—Å-–∞–∫–∫–∞—É–Ω—Ç–∞. **–í–∞–∂–Ω–æ:** –ø—É—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º  |
| `PIPELINE_SCHEDULE`              | `.env`                            | CRON-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è DAG (–µ—Å–ª–∏ –ø—É—Å—Ç–æ–µ - –∑–∞–ø—É—Å–∫ –≤ —Ä—É—á–Ω—É—é).                                                                                                              |

**Hardcodes**

* `dags/pipeline_dag.py` ‚Äî `start_date=datetime(2025, 1, 1)` ‚Üí –ø–æ–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
* `etl/config.py` ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç URL –ø—Ä–∏–º–µ—Ä–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞; –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫.
* –í `logger_setup.py` –∏–º—è –ª–æ–≥–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ, –Ω–æ –ø—É—Ç—å —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
* –ë–î Airflow (`AIRFLOW__DATABASE__SQL_ALCHEMY_CONN`) —Å–µ–π—á–∞—Å –Ω–∞ `sqlite:///‚Ä¶` ‚Äî –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Å–º–µ–Ω–∏—Ç–µ –Ω–∞ PostgreSQL/MySQL.
* –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (`SequentialExecutor`) ‚Äî —Ç–æ –∂–µ —Å–∞–º–æ–µ: –≤ prod –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ `LocalExecutor`, `CeleryExecutor`, etc.

---

## üöÄ –ó–∞–ø—É—Å–∫

### 1. –õ–æ–∫–∞–ª—å–Ω—ã–π —Å makefile

```bash
# —Å–æ–∑–¥–∞—ë–º/–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —Å—Ç–∞–≤–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
make setup

# –ø—Ä–æ–≥–æ–Ω—è–µ–º –≤—Å—é —Ü–µ–ø–æ—á–∫—É: —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ª—è–≥—É—Ç –≤ results/, –ª–æ–≥–∏ ‚Äî –≤ logs/
make run
```

### 2. Docker

```bash
# 0) –∑–∞–ø–æ–ª–Ω–∏—Ç—å .env –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–ª—é—á –ª–µ–∂–∏—Ç –≤ keys/
docker compose up --build
```

* Airflow UI: [http://localhost:8080](http://localhost:8080), –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å `admin` / `admin`.
* DAG **breast\_cancer\_pipeline** –ª–∏–±–æ –∑–∞–ø—É—Å–∫ —Ä—É—á–Ω–æ–π Run.

**–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ**

1. `PIPELINE_SCHEDULE="0 3 * * *"` (–ø—Ä–∏–º–µ—Ä: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00 UTC) –≤ `.env`.
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã ‚Äî DAG –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç CRON.

---


## üí° –ò–¥–µ–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è

1. **–ë–æ–ª–µ–µ –≥–∏–±–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã `pipeline_<dag_run_id>.log`, —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤ S3 / Stackdriver.
2. **Data validation** (`great_expectations`, `pandera`) –¥–æ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏.
3. **Unit-—Ç–µ—Å—Ç—ã** –Ω–∞ –∫–∞–∂–¥—ã–π ETL-–º–æ–¥—É–ª—å (`pytest` + fixtures).
4. **CI/CD** ‚Äî –∞–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—è Docker-–æ–±—Ä–∞–∑–∞, –¥–µ–ø–ª–æ–π DAG —á–µ—Ä–µ–∑ Helm-chart –≤ Airflow-Kubernetes.
5. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫** ‚Üí —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ JSON –º–æ–∂–Ω–æ –ø—Ä–æ–∫–∏–Ω—É—Ç—å –≤ Grafana / Loki.

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

* **load\_data**
  –°–µ—Ç–µ–≤—ã–µ —Å–±–æ–∏ ‚Äî timeout, 404. –°–µ–π—á–∞—Å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `requests.get` —Å `timeout=30` –∏ `raise_for_status()`. –í –¥–∞–ª—å–Ω–µ–π—à–µ–º –ª—É—á—à–µ –¥–æ–±–∞–≤–∏—Ç—å retry c —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π.
* **preprocess**
  –ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ö–µ–º–∞ CSV, –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ `NaN`. –ö–æ–ª–æ–Ω–∫–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—é—Ç—Å—è —è–≤–Ω–æ, –Ω–æ –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å—Ö–µ–º—ã –ø–µ—Ä–µ–¥ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å—Ç–æ–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å.
* **train\_model**
  `LogisticRegression` –º–æ–∂–µ—Ç –Ω–µ —Å–æ–π—Ç–∏—Å—å 
  `ConvergenceWarning`, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å `max_iter`.
* **upload\_results**

  * –ù–µ –Ω–∞–π–¥–µ–Ω JSON-–∫–ª—é—á ‚Üí `DefaultCredentialsError`.
  * 403 ¬´Billing account disabled¬ª –∏–ª–∏ –Ω–µ—Ö–≤–∞—Ç–∫–∞ IAM-–ø—Ä–∞–≤ –Ω–∞ bucket.
    –ü—É—Ç—å –∫ –∫–ª—é—á—É –ø—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ –∞–±—Å–æ–ª—é—Ç–Ω–æ–º—É, –µ—Å—Ç—å `early-exit`, –µ—Å–ª–∏ `GCS_BUCKET` –ø—É—Å—Ç. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –ø–æ–ª–µ–∑–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞ –∏/–∏–ª–∏ —Å–ª–∞—Ç—å –∞–ª–µ—Ä—Ç –≤ –º–µ—Å–µ–Ω–¥–∂–µ—Ä.
* **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Airflow**

  * **SQLite –∫–∞–∫ metadata-–ë–î**: Airflow –ø—Ä—è–º–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç ‚Äî *¬´Do not use SQLite as metadata DB in production¬ª*. –í –ø—Ä–æ–¥–µ –ª—É—á—à–µ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ PostgreSQL.
  * **SequentialExecutor**: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ‚Äî –≥–æ–¥–∏—Ç—Å—è –ª–∏—à—å –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤; –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –ª—É—á—à–µ `LocalExecutor`, `CeleryExecutor` –∏–ª–∏ `KubernetesExecutor`.
